# LockTower

Lock Tower is a an implementation of Nakomoto Consensus with time based locks. It satisfies the following properties:

* if the nodes share a common ancenstor then they will converge to a branch containing that ancenstor no matter how they are partitioned.

* rollback requires exponentially more time for older votes then for newer votes.

* Nodes can independetly configure how much convergance in voting they would like to see before commiting a vote to a higher lockout.  This allows each node to make a tradeoff of risk and reward.

## Time

For networks like Solana time can be the PoH hash count (which is a VDF) as it is generated by the network.  Networks that can use an external source of time can rely on that source. 

## Algorithm

The basic idea to this approach is to stack consensus votes.  Each consensus vote has a "lockout" before it can be switched.  When a vote is added to the stack the lockouts of all the votes in the stack are doubled.  With each new vote a node commits the previous votes to a ever increasing lockout.  Since at 32 votes we can consider the system to be at `max lockout` any votes with a lockout above 1<<32 are dequeued.


### Rollback

Before a vote is pushed to the stack, all the votes leading up to vote with a lower lockout time then the new vote are purged.

After rollback lockouts are not doubled until the node catches up to the rollback height of votes.

For example, a vote stack with the following state:
```
vote height | lockout |
-----------------------
          4 |      2  |
          3 |      4  | 
          2 |      8  | 
          1 |      16 |
```
If the next vote is at height 9 the resulting state will be
```
vote height | lockout |
-----------------------
          9 |      2  |
          2 |      8  | 
          1 |      16 |
``` 
